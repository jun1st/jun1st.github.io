{"expireTime":9007200859284084000,"key":"transformer-remark-markdown-html-ast-6c915334adee64378a631b56e0c89333-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-external-links-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"系统已经微服务化了，并且使用 Eureka 来做了服务的发现与治理。那么接下去的问题就是如何把服务暴露给外部终端使用了。","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":61,"offset":61}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":61,"offset":61}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"把所有的 Api Endpoint 都暴露出去吗？如何做请求验证呢？ 如果把所有的 Api Endpoint 都暴露出去，在每个 Api Endpoint\n都做一次 AccessToken 验证码？并且终端请求 Api 的粒度和微服务提供的粒度是不一致的。比如：请求一个用户的 Profile 数据，\n终端需要的可能是个人信息，账户信息，近期订单信息等。 而在三个信息分别有三个微服务提供，让客户端请求三次吗？","position":{"start":{"line":4,"column":1,"offset":63},"end":{"line":6,"column":55,"offset":268}}}],"position":{"start":{"line":4,"column":1,"offset":63},"end":{"line":6,"column":55,"offset":268}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Api Gateway","position":{"start":{"line":8,"column":3,"offset":272},"end":{"line":8,"column":14,"offset":283}}}],"position":{"start":{"line":8,"column":1,"offset":270},"end":{"line":8,"column":16,"offset":285}}}],"position":{"start":{"line":8,"column":1,"offset":270},"end":{"line":8,"column":16,"offset":285}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"实现一个 Api Gateway 作为一个统一的入口，并且能够把请求转发到背后相应的微服务端。","position":{"start":{"line":10,"column":1,"offset":287},"end":{"line":10,"column":48,"offset":334}}}],"position":{"start":{"line":10,"column":1,"offset":287},"end":{"line":10,"column":48,"offset":334}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*UT0vkwQSbCH5rQMia4sojg.png","alt":null},"children":[],"position":{"start":{"line":12,"column":1,"offset":336},"end":{"line":12,"column":75,"offset":410}}}],"position":{"start":{"line":12,"column":1,"offset":336},"end":{"line":12,"column":75,"offset":410}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"用 Zuul 实现 Api Gateway","position":{"start":{"line":14,"column":3,"offset":414},"end":{"line":14,"column":24,"offset":435}}}],"position":{"start":{"line":14,"column":1,"offset":412},"end":{"line":14,"column":26,"offset":437}}}],"position":{"start":{"line":14,"column":1,"offset":412},"end":{"line":14,"column":26,"offset":437}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用 zuul 能非常快速的实现一个 Api Gateway，同时能和 Eureka 很好的集成。","position":{"start":{"line":16,"column":1,"offset":439},"end":{"line":16,"column":49,"offset":487}}}],"position":{"start":{"line":16,"column":1,"offset":439},"end":{"line":16,"column":49,"offset":487}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"建立一个 Spring Boot Application，添加 Eureka Client 和 Zuul 相关的依赖","position":{"start":{"line":18,"column":1,"offset":489},"end":{"line":18,"column":59,"offset":547}}}],"position":{"start":{"line":18,"column":1,"offset":489},"end":{"line":18,"column":59,"offset":547}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt;\n&lt;/dependency&gt;</code></pre></div>","position":{"start":{"line":20,"column":1,"offset":549},"end":{"line":29,"column":4,"offset":843}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在 Application 上开启 EnableDiscoveryClient 和 ZuulProxy","position":{"start":{"line":31,"column":1,"offset":845},"end":{"line":31,"column":52,"offset":896}}}],"position":{"start":{"line":31,"column":1,"offset":845},"end":{"line":31,"column":52,"offset":896}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@SpringBootApplication\n@EnableDiscoveryClient\n@EnableZuulProxy\n@RestController\npublic class GatewayApplication {\n\n    @Autowired\n    private DiscoveryClient discoveryClient;\n\n    public static void main(String[] args) {\n        SpringApplication.run(GatewayApplication.class, args);\n    }\n\n    @GetMapping(&quot;/&quot;)\n    public String home() {\n        List&lt;ServiceInstance&gt; list = discoveryClient.getInstances(&quot;SERVICE-PROVIDER&quot;);\n\n        if(list != null &amp;&amp; list.size() &gt; 0 )\n        {\n            return list.get(0).getUri().toString() + &quot;: new 2&quot;;\n        }\n\n        return &quot;cannot found consultants&quot;;\n    }\n}</code></pre></div>","position":{"start":{"line":33,"column":1,"offset":898},"end":{"line":59,"column":4,"offset":1512}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在代码里，我们用 ","position":{"start":{"line":61,"column":1,"offset":1514},"end":{"line":61,"column":10,"offset":1523}}},{"type":"raw","value":"<code class=\"language-text\">discoveryClient</code>","position":{"start":{"line":61,"column":10,"offset":1523},"end":{"line":61,"column":27,"offset":1540}}},{"type":"text","value":" 从 Eureka Server 那里查询是否有注册为 ","position":{"start":{"line":61,"column":27,"offset":1540},"end":{"line":61,"column":55,"offset":1568}}},{"type":"raw","value":"<code class=\"language-text\">service-provider</code>","position":{"start":{"line":61,"column":55,"offset":1568},"end":{"line":61,"column":73,"offset":1586}}},{"type":"text","value":" 的微服务。","position":{"start":{"line":61,"column":73,"offset":1586},"end":{"line":61,"column":79,"offset":1592}}}],"position":{"start":{"line":61,"column":1,"offset":1514},"end":{"line":61,"column":79,"offset":1592}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"打开首页：","position":{"start":{"line":63,"column":1,"offset":1594},"end":{"line":63,"column":6,"offset":1599}}}],"position":{"start":{"line":63,"column":1,"offset":1594},"end":{"line":63,"column":6,"offset":1599}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*Wktlsidrk8FadV8DSku9Lw.png","alt":null},"children":[],"position":{"start":{"line":65,"column":1,"offset":1601},"end":{"line":65,"column":75,"offset":1675}}}],"position":{"start":{"line":65,"column":1,"offset":1601},"end":{"line":65,"column":75,"offset":1675}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里现实的信息和 Eureka Server 上注册的信息一致，","position":{"start":{"line":67,"column":1,"offset":1677},"end":{"line":67,"column":33,"offset":1709}}}],"position":{"start":{"line":67,"column":1,"offset":1677},"end":{"line":67,"column":33,"offset":1709}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"说能从 Eureka Server 发现微服务信息成功。 并且 Zuul 会默认把发现的微服务，通过 zuul 暴露给外部调用：","position":{"start":{"line":69,"column":1,"offset":1711},"end":{"line":69,"column":65,"offset":1775}}}],"position":{"start":{"line":69,"column":1,"offset":1711},"end":{"line":69,"column":65,"offset":1775}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*4ebYDW4h_TfG_JlWHL325g.png","alt":null},"children":[],"position":{"start":{"line":71,"column":1,"offset":1777},"end":{"line":71,"column":75,"offset":1851}}}],"position":{"start":{"line":71,"column":1,"offset":1777},"end":{"line":71,"column":75,"offset":1851}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里我们通过访问 gateway application 的 ","position":{"start":{"line":73,"column":1,"offset":1853},"end":{"line":73,"column":32,"offset":1884}}},{"type":"raw","value":"<code class=\"language-text\">service-provider</code>","position":{"start":{"line":73,"column":32,"offset":1884},"end":{"line":73,"column":50,"offset":1902}}},{"type":"text","value":" , zuul 会把这个请求转发给\nservice-provider 服务，并且返回结果，","position":{"start":{"line":73,"column":50,"offset":1902},"end":{"line":74,"column":28,"offset":1947}}}],"position":{"start":{"line":73,"column":1,"offset":1853},"end":{"line":74,"column":28,"offset":1947}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"跟直接访问，两者一样。","position":{"start":{"line":76,"column":1,"offset":1949},"end":{"line":76,"column":12,"offset":1960}}}],"position":{"start":{"line":76,"column":1,"offset":1949},"end":{"line":76,"column":12,"offset":1960}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*hbk6Q63f9hOYvCzNcjyTQw.png","alt":null},"children":[],"position":{"start":{"line":78,"column":1,"offset":1962},"end":{"line":78,"column":75,"offset":2036}}}],"position":{"start":{"line":78,"column":1,"offset":1962},"end":{"line":78,"column":75,"offset":2036}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"到这里，一个简单的微服务应用就跑起来了， 哈利路亚","position":{"start":{"line":80,"column":1,"offset":2038},"end":{"line":80,"column":26,"offset":2063}}}],"position":{"start":{"line":80,"column":1,"offset":2038},"end":{"line":80,"column":26,"offset":2063}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Github demo 地址： ","position":{"start":{"line":82,"column":1,"offset":2065},"end":{"line":82,"column":17,"offset":2081}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/jun1st/gateway","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"gateway","position":{"start":{"line":82,"column":18,"offset":2082},"end":{"line":82,"column":25,"offset":2089}}}],"position":{"start":{"line":82,"column":17,"offset":2081},"end":{"line":82,"column":61,"offset":2125}}}],"position":{"start":{"line":82,"column":1,"offset":2065},"end":{"line":82,"column":61,"offset":2125}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":82,"column":61,"offset":2125}}}}