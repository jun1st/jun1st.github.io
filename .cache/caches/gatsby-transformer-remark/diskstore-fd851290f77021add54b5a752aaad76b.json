{"expireTime":9007200864318180000,"key":"transformer-remark-markdown-html-ast-468299cf5a18e8c10663cf0091dc2e5a-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-external-links-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@fengqijun/%C3%A4%C2%BD%C2%BF%C3%A7%C2%94%C2%A8-spring-cloud-%C3%A6%C2%9E%C2%84%C3%A5%C2%BB%C2%BA%C3%A5%C2%BE%C2%AE%C3%A6%C2%9C%C2%8D%C3%A5%C2%8A%C2%A1%C3%A4%C2%B9%C2%8B%C3%A4%C2%BA%C2%8C-eureka-client-acd6022f94df","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"上一篇","position":{"start":{"line":2,"column":2,"offset":2},"end":{"line":2,"column":5,"offset":5}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":106,"offset":106}}},{"type":"text","value":"\n注册了一个简单的 Servcie，这一篇讲一下使用 RestTemplate 来调用注册在 Eureka 上的服务。","position":{"start":{"line":2,"column":106,"offset":106},"end":{"line":3,"column":59,"offset":165}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":3,"column":59,"offset":165}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service Provider","position":{"start":{"line":5,"column":3,"offset":169},"end":{"line":5,"column":19,"offset":185}}}],"position":{"start":{"line":5,"column":1,"offset":167},"end":{"line":5,"column":21,"offset":187}}}],"position":{"start":{"line":5,"column":1,"offset":167},"end":{"line":5,"column":21,"offset":187}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"先给 Service Provider 写一个简单的返回一个 Json 对象的 Api，Greeting","position":{"start":{"line":7,"column":1,"offset":189},"end":{"line":7,"column":53,"offset":241}}}],"position":{"start":{"line":7,"column":1,"offset":189},"end":{"line":7,"column":53,"offset":241}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> lombok<span class=\"token punctuation\">.</span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span>experimental</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Accessors</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token annotation punctuation\">@Accessors</span><span class=\"token punctuation\">(</span>chain <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Greeting</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":9,"column":1,"offset":243},"end":{"line":18,"column":4,"offset":404}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Root Api 直接返回一个 Greeting 对象","position":{"start":{"line":20,"column":1,"offset":406},"end":{"line":20,"column":28,"offset":433}}}],"position":{"start":{"line":20,"column":1,"offset":406},"end":{"line":20,"column":28,"offset":433}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">GetMapping</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">.</span>annotation</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">RestController</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Greeting</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Greeting</span> greeting <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Greeting</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        greeting<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Jon\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">setMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"How are you\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> greeting<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":22,"column":1,"offset":435},"end":{"line":39,"column":4,"offset":821}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"结果：","position":{"start":{"line":41,"column":1,"offset":823},"end":{"line":41,"column":4,"offset":826}}}],"position":{"start":{"line":41,"column":1,"offset":823},"end":{"line":41,"column":4,"offset":826}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*VFC-nfRVnVVhvBZ_wMzTvA.png","alt":null},"children":[],"position":{"start":{"line":43,"column":1,"offset":828},"end":{"line":43,"column":75,"offset":902}}}],"position":{"start":{"line":43,"column":1,"offset":828},"end":{"line":43,"column":75,"offset":902}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"微服务提供方已经 Ready。","position":{"start":{"line":45,"column":1,"offset":904},"end":{"line":45,"column":16,"offset":919}}}],"position":{"start":{"line":45,"column":1,"offset":904},"end":{"line":45,"column":16,"offset":919}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Service Consumer","position":{"start":{"line":47,"column":3,"offset":923},"end":{"line":47,"column":19,"offset":939}}}],"position":{"start":{"line":47,"column":1,"offset":921},"end":{"line":47,"column":21,"offset":941}}}],"position":{"start":{"line":47,"column":1,"offset":921},"end":{"line":47,"column":21,"offset":941}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"同样也是一个 Spring Boot 应用，同时也是 Eureka 的一个 Client。作为调用方，她是一个使用者。至于是否作为一个服务提供者，可以自由选择。","position":{"start":{"line":49,"column":1,"offset":943},"end":{"line":49,"column":81,"offset":1023}}}],"position":{"start":{"line":49,"column":1,"offset":943},"end":{"line":49,"column":81,"offset":1023}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"同样是通过 ","position":{"start":{"line":51,"column":1,"offset":1025},"end":{"line":51,"column":7,"offset":1031}}},{"type":"raw","value":"<code class=\"language-text\">application.properties</code>","position":{"start":{"line":51,"column":7,"offset":1031},"end":{"line":51,"column":31,"offset":1055}}},{"type":"text","value":" 配置 eureka 属性","position":{"start":{"line":51,"column":31,"offset":1055},"end":{"line":51,"column":44,"offset":1068}}}],"position":{"start":{"line":51,"column":1,"offset":1025},"end":{"line":51,"column":44,"offset":1068}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.port=8002\n\nspring.application.name=service-consumer\n\neureka.client.register-with-eureka=true\neureka.client.enabled=true\neureka.client.serviceUrl.defaultZone=http://localhost:8000/eureka\neureka.instance.prefer-ip-address=true</code></pre></div>","position":{"start":{"line":53,"column":1,"offset":1070},"end":{"line":62,"column":4,"offset":1309}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里设置 ","position":{"start":{"line":64,"column":1,"offset":1311},"end":{"line":64,"column":6,"offset":1316}}},{"type":"raw","value":"<code class=\"language-text\">register-with-eureka</code>","position":{"start":{"line":64,"column":6,"offset":1316},"end":{"line":64,"column":28,"offset":1338}}},{"type":"text","value":" 为 ","position":{"start":{"line":64,"column":28,"offset":1338},"end":{"line":64,"column":31,"offset":1341}}},{"type":"raw","value":"<code class=\"language-text\">true</code>","position":{"start":{"line":64,"column":31,"offset":1341},"end":{"line":64,"column":37,"offset":1347}}},{"type":"text","value":"，就会把 service-consumer 也注册为一个服务提供方。","position":{"start":{"line":64,"column":37,"offset":1347},"end":{"line":64,"column":71,"offset":1381}}}],"position":{"start":{"line":64,"column":1,"offset":1311},"end":{"line":64,"column":71,"offset":1381}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"可以看到 Service Consumer 也注册进 Eureka 了。\n","position":{"start":{"line":66,"column":1,"offset":1383},"end":{"line":67,"column":1,"offset":1420}}},{"type":"element","tagName":"img","properties":{"src":"https://cdn-images-1.medium.com/max/1600/1*dEKBzhYAcTZY4e-INBBVfg.png","alt":null},"children":[],"position":{"start":{"line":67,"column":1,"offset":1420},"end":{"line":67,"column":75,"offset":1494}}}],"position":{"start":{"line":66,"column":1,"offset":1383},"end":{"line":67,"column":75,"offset":1494}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Eureka Services 之间如何通讯","position":{"start":{"line":69,"column":3,"offset":1498},"end":{"line":69,"column":25,"offset":1520}}}],"position":{"start":{"line":69,"column":1,"offset":1496},"end":{"line":69,"column":27,"offset":1522}}}],"position":{"start":{"line":69,"column":1,"offset":1496},"end":{"line":69,"column":27,"offset":1522}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"有一个说法说 CS 有两个难题，一个是变量命名，另一个是 ","position":{"start":{"line":71,"column":1,"offset":1524},"end":{"line":71,"column":30,"offset":1553}}},{"type":"raw","value":"<code class=\"language-text\">Cache Invalidation</code>","position":{"start":{"line":71,"column":30,"offset":1553},"end":{"line":71,"column":50,"offset":1573}}},{"type":"text","value":"。 还有一个说话是，CS\n中的问题，没有一个是不能通过加一层来解决了。这个 Eureka Server 就相当于是中间加的一层。","position":{"start":{"line":71,"column":50,"offset":1573},"end":{"line":72,"column":52,"offset":1637}}}],"position":{"start":{"line":71,"column":1,"offset":1524},"end":{"line":72,"column":52,"offset":1637}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Consumer 调用 Provider","position":{"start":{"line":74,"column":1,"offset":1639},"end":{"line":74,"column":21,"offset":1659}}}],"position":{"start":{"line":74,"column":1,"offset":1639},"end":{"line":74,"column":21,"offset":1659}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RestTemplate</span> restTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">echo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/call-provider\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Object</span> result <span class=\"token operator\">=</span> restTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">getForObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://SERVICE-PROVIDER\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token annotation punctuation\">@LoadBalanced</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RestTemplate</span> <span class=\"token function\">restTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RestTemplateBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>","position":{"start":{"line":76,"column":1,"offset":1661},"end":{"line":102,"column":4,"offset":2165}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里个 ","position":{"start":{"line":104,"column":1,"offset":2167},"end":{"line":104,"column":5,"offset":2171}}},{"type":"raw","value":"<code class=\"language-text\">Consumer</code>","position":{"start":{"line":104,"column":5,"offset":2171},"end":{"line":104,"column":15,"offset":2181}}},{"type":"text","value":" 添加了一个 ","position":{"start":{"line":104,"column":15,"offset":2181},"end":{"line":104,"column":22,"offset":2188}}},{"type":"raw","value":"<code class=\"language-text\">/call-provider</code>","position":{"start":{"line":104,"column":22,"offset":2188},"end":{"line":104,"column":38,"offset":2204}}},{"type":"text","value":" 方法，在方法内，通过 RestTemplate，调用了 provider 的 Api。\n这里并没有使用 Url 地址或者 IP 地址，而是使用了注册在 Eureka Server 上的 application name，并且成功的得到了返回结果。","position":{"start":{"line":104,"column":38,"offset":2204},"end":{"line":105,"column":80,"offset":2328}}}],"position":{"start":{"line":104,"column":1,"offset":2167},"end":{"line":105,"column":80,"offset":2328}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">RestTemplate</code>","position":{"start":{"line":107,"column":1,"offset":2330},"end":{"line":107,"column":15,"offset":2344}}},{"type":"text","value":" 的 ","position":{"start":{"line":107,"column":15,"offset":2344},"end":{"line":107,"column":18,"offset":2347}}},{"type":"raw","value":"<code class=\"language-text\">LoadBalanced</code>","position":{"start":{"line":107,"column":18,"offset":2347},"end":{"line":107,"column":32,"offset":2361}}},{"type":"text","value":" 注解来自 Spring Cloud 的 Ribbon 依赖。 Ribbon 是用来干什么的？\n下篇再见～","position":{"start":{"line":107,"column":32,"offset":2361},"end":{"line":108,"column":6,"offset":2414}}}],"position":{"start":{"line":107,"column":1,"offset":2330},"end":{"line":108,"column":6,"offset":2414}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/jun1st/service-consumer","target":"_blank","rel":"nofollow noopener noreferrer"},"children":[{"type":"text","value":"源代码地址","position":{"start":{"line":110,"column":2,"offset":2417},"end":{"line":110,"column":7,"offset":2422}}}],"position":{"start":{"line":110,"column":1,"offset":2416},"end":{"line":110,"column":52,"offset":2467}}}],"position":{"start":{"line":110,"column":1,"offset":2416},"end":{"line":110,"column":52,"offset":2467}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":110,"column":52,"offset":2467}}}}